<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Impact Animation</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #fff;
        }

        .star-container {
            position: relative;
        }

        /* Estilos para la estrella principal */
        #main-star {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Estilos para la animación */
        .impact-star {
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 100px;
            animation: impactEffect 1s forwards;
        }

        @keyframes impactEffect {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="star-container">
        <!-- Reemplazamos el cuadrado violeta con la estrella SVG como imagen principal -->
        <img id="main-star" src="Star.svg" alt="Main Star">
    </div>
    <script>
        let audioContext, analyser, dataArray;
        const impacts = [];
        const impactCooldown = 100;
        let lastImpactTime = 0;
    
        async function startAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    
            if (audioContext.state === 'suspended') {
                await audioContext.resume();
            }
    
            const source = audioContext.createMediaStreamSource(stream);
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 2048;
    
            source.connect(analyser);
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyzeAudio();
        }
    
        function analyzeAudio() {
            analyser.getByteFrequencyData(dataArray);
    
            if (detectPercussion(dataArray)) {
                impacto();
            }
    
            requestAnimationFrame(analyzeAudio);
        }
    
        let previousMaxFrequency = 0;
    
        function detectPercussion(frequencies) {
            const threshold = 80;
            const minimumPeakChange = 20;
            let currentMaxFrequency = Math.max(...frequencies);
    
            if (currentMaxFrequency > threshold && (currentMaxFrequency - previousMaxFrequency) > minimumPeakChange) {
                previousMaxFrequency = currentMaxFrequency;
                return true;
            }
    
            previousMaxFrequency = currentMaxFrequency;
            return false;
        }
    
        function impacto() {
            const currentTime = Date.now();
    
            if (currentTime - lastImpactTime < impactCooldown) {
                return;
            }
    
            lastImpactTime = currentTime;
    
            if (impacts.length >= 5) return;
    
            const container = document.querySelector('.star-container');
    
            // Crear imagen y asignar src al archivo SVG
            const impactStar = document.createElement('img');
            impactStar.classList.add('impact-star');
            impactStar.src = 'Star.svg';
    
            const mainStar = document.getElementById('main-star');
            impactStar.style.top = `${mainStar.offsetTop}px`;
            impactStar.style.left = `${mainStar.offsetLeft}px`;
    
            container.appendChild(impactStar);
            impacts.push(impactStar);
    
            setTimeout(() => {
                impactStar.remove();
                impacts.splice(impacts.indexOf(impactStar), 1);
            }, 1000);
            console.log("¡Percusión detectada! Impacto activado.");
        }
    
        startAudio();
    </script>
    </body>
    </html>
    